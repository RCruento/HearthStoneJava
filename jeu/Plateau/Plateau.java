package jeu.Plateau;

import jeu.Exception.HearthstoneException;
import jeu.Joueur.IJoueur;
import java.util.ArrayList;

/**
 * Classe Plateau represenant le plateau de ou se passe la partie
 * @author  Rayan KOUSSA
 * @version 0.1
 */


public class Plateau implements IPlateau {

    private ArrayList<IJoueur> joueurs;
    private boolean debuter = false;
    private IJoueur joueurCourant;

    /**
     * Singleton
     */
    private static Plateau INSTANCE = new Plateau();

    /**
     * Point d'accès pour l'instance unique du singleton
     */
    public static Plateau getInstance() {
        if (INSTANCE == null) {
            new Plateau();
        }
        return INSTANCE;
    }

    private Plateau() {
    }

    //Getter Setter

    @Override
    public IJoueur getAdversaire(IJoueur courantplayer) {
        if (courantplayer == null) {
            throw new IllegalArgumentException("Aucun adveraire");
        }
        if (courantplayer.getPseudo().equals(this.joueurs.get(0).getPseudo())) {
            return this.joueurs.get(1);
        }
        if (courantplayer.getPseudo().equals(this.joueurs.get(1).getPseudo())) {
            return this.joueurs.get(0);
        }
        return courantplayer;
    }

    public void setPlayers(ArrayList<IJoueur> players) {
        this.joueurs = players;
    }

    @Override
    public IJoueur getJoueurCourant() {
        return this.joueurCourant;
    }

    @Override
    public void setJoueurCourant(IJoueur joueur) {
        this.joueurCourant = joueur;
    }


    // Methodes

    /**
     * Ajoute un joueur a la partie
     * @param joueur
     */
    @Override
    public void ajouterJoueur(IJoueur joueur) {
        if (this.joueurs == null) {
            this.joueurs = new ArrayList<>();
        }
        this.joueurs.add(joueur);
    }

    /**
     * Permet de commencer un partie
     */
    @Override
    public void demarerPartie() {
        for (int i = 0; i < 4; i++) {
            this.joueurs.get(0).piocher();
            this.joueurs.get(1).piocher();
        }
        this.getJoueurCourant().piocher();
        System.out.println(this.joueurCourant.getHeros() + " Commence");
        this.debuter = true;
    }

    /**
     * Verifie si une partie a commencée
     * @return true si elle a commencée, false sinon
     */
    @Override
    public boolean estDemaree() {
        return this.debuter;
    }

    /**
     * Le joueur en parametre gagne la partie
     * @param joueur Joueur courant
     */
    @Override
    public void gagnerPartie(IJoueur joueur) {
        if (getAdversaire(joueur).getHeros().mort()) {
            this.debuter = false;
            System.out.println("Joueur : " + joueur.getPseudo() + " a gagné la partie");
            System.exit(0);
        }
    }

    /**
     * Finis le tour du joueur courant
     * @param joueur
     * @throws HearthstoneException
     * @see jeu.Joueur.Joueur
     */
    @Override
    public void finirTour(IJoueur joueur) throws HearthstoneException {

        if (!this.getAdversaire(this.getJoueurCourant()).getHeros().mort()) {
            this.joueurCourant.finirTour();
            this.getAdversaire(this.getJoueurCourant()).prendreTour();
            this.getJoueurCourant().piocher();
        } else {
            this.gagnerPartie(joueur);
        }


    }

    /**
     * Affiche le plateau
     * @return le plateau
     */
    public String toString() {
        if (this.getJoueurCourant().getJeu().size() == 0 && this.getAdversaire(this.getJoueurCourant()).getJeu().size() == 0) {
            return
                    "Adversaire : " + this.getAdversaire(this.joueurCourant).getPseudo() + "  " + this.getAdversaire(this.joueurCourant).getHeros() + "\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "                                                                |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "                                                         |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            this.joueurCourant.toString();
        } else if (this.getJoueurCourant().getJeu().size() != 0 && this.getAdversaire(this.getJoueurCourant()).getJeu().size() == 0) {
            return
                    "Adversaire : " + this.getAdversaire(this.joueurCourant).getPseudo() + "  " + this.getAdversaire(this.joueurCourant).getHeros() + "\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "                                                                |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + this.getJoueurCourant().afficherJeu() + "                                                         |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            this.joueurCourant.toString();

        } else if (this.getJoueurCourant().getJeu().size() == 0 && this.getAdversaire(this.getJoueurCourant()).getJeu().size() != 0) {
            return
                    "Adversaire : " + this.getAdversaire(this.joueurCourant).getPseudo() + "  " + this.getAdversaire(this.joueurCourant).getHeros() + "\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + this.getAdversaire(this.getJoueurCourant()).afficherJeu() + "                                                                |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|" + "                                                         |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "|                                                                                                                                                                                                                                                                                                                    |\n" +
                            "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                            this.joueurCourant.toString();

        }
        return
                "Adversaire : " + this.getAdversaire(this.joueurCourant).getPseudo() + "  " + this.getAdversaire(this.joueurCourant).getHeros() + "\n" +
                        "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|" + this.getAdversaire(this.getJoueurCourant()).afficherJeu() + "                                                                |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                        "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                        "|" + "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|" + this.getJoueurCourant().afficherJeu() + "                                                         |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "|                                                                                                                                                                                                                                                                                                                    |\n" +
                        "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n" +
                        this.joueurCourant.toString();


    }
}